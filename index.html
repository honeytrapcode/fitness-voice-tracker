<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   <style>
       
        body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          margin: 0;
          padding: 20px;
          background: url('https://raw.githubusercontent.com/honeytrapcode/fitness-voice-tracker/main/assets/background.jpg') no-repeat center center fixed;
          background-size: cover;
          color: #e0e0e0;
        }

    
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background-color: rgba(26, 26, 26, 0.85);
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(255, 255, 255, 0.05);
      }
    
      h1 {
          color: #ffffff;
          text-align: center;
          margin-bottom: 30px;
        }
        
      h3 {
          color: #ffffff;
          text-align: center;
          margin-bottom: 20px;
        }

    
      .controls, .github-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 30px;
      }

    .form-entry {
      background-color: #222;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      color: #ccc;
    }
       
    /* Replace the button styling in your CSS with this updated version */
    button {
      padding: 12px 20px;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }
    
    button:hover {
      filter: brightness(110%);
    }
    
    button:disabled {
      background-color: #444;
      cursor: not-allowed;
    }
    
    /* Start Recording - slightly dark amber */
    #startBtn {
      background-color: #d4a017; /* slightly dark amber */
    }
    
    /* Stop Recording - keep as is */
    button.stop, #stopBtn {
      background-color: #d11a2a; /* original red */
    }
    
    /* Save Data - slightly dark green */
    button.save, #saveBtn {
      background-color: #2e8b57; /* slightly dark green */
      color: white; /* Change text color to white for better contrast */
    }
    
    /* Download CSV - slightly dark blue */
    #downloadBtn {
      background-color: #b83280; /* slightly dark blue */
    }
    
    /* Configure GitHub - slightly dark pink */
    #configureGithubBtn {
      background-color: #b83280; /* slightly dark pink */
    }
    
    #loadFromGithubBtn {
      background-color: #d4a017; /* slightly dark amber */
    }
    /* Create GitHub Backup - slightly dark pink */
     #createBackupBtn {
      background-color: #2e8b57; /* slightly dark green */
    }
    
      .status, .transcript, .instructions, .github-controls {
        background-color: #222;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
        color: #ccc;
      }

       .form-entry {
      background-color: #222;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      color: #ccc;
    }

       /* Add this new class after the form-entry class */
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
    }

    .form-group {
      flex: 1 1 calc(33.333% - 15px);
      min-width: 200px;
    }

       
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        color: #ddd;
        overflow-x: auto;
      }
    
      th, td {
        border: 1px solid #444;
        padding: 12px;
        text-align: left;
      }
    
      th {
        background-color: #333;
      }
    
      tr:nth-child(even) {
        background-color: #1c1c1c;
      }
    
      input, select {
        width: 100%;
        padding: 10px;
        border: 1px solid #555;
        border-radius: 4px;
        background-color: #111;
        color: #fff;
      }
    
      label {
        margin-bottom: 5px;
        font-weight: bold;
        color: #bbb;
      }
    
      .record-indicator {
        background-color: #ff4d4d;
        animation: pulse 1.5s infinite;
      }
    
      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }

               /* Add this media query at the end of your style section */
        @media (max-width: 768px) {
          .form-group {
            flex: 1 1 100%;
            min-width: 0;
          }
          
          .container {
            padding: 15px;
          }
          
          .controls, .github-actions {
            flex-direction: column;
          }
          
          button {
            width: 100%;
          }
        }

        /* Media query for larger screens */
        @media (min-width: 769px) {
          .form-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
          }
        }

        /* Analytics section styles */
        .analytics-section {
          background-color: #222;
          padding: 20px;
          border-radius: 5px;
          margin-bottom: 20px;
        }

        .chart-container {
          background-color: rgba(34, 34, 34, 0.9);
          padding: 15px;
          border-radius: 5px;
          margin-bottom: 20px;
          height: 400px;
        }

        /* Table improvements */
        .data-display {
          overflow-x: auto;
          margin-top: 20px;
        }

        table {
          min-width: 100%;
          white-space: nowrap;
        }

        th, td {
          padding: 8px 12px;
        }

        /* Loading indicator */
        .loading {
          display: none;
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background-color: rgba(0, 0, 0, 0.8);
          color: white;
          padding: 20px;
          border-radius: 5px;
          z-index: 1000;
        }
    </style>

</head>
<body>
    <div class="container">
        <h1>Tracker</h1>
        
        <div class="instructions">
            <h3>How to use:</h3>
            <p>1. Click "Start Recording" and speak your data.</p>
            <p>2. Use simple phrases like "Today I ran 3.5 miles" or "Yesterday I did 50 pushups".</p>
            <p>3. The transcript will appear below and will be processed to update your tracking data.</p>
            <p>4. Alternatively, use the form below to manually enter your data.</p>
        </div>
        
        <div class="controls">
            <button id="startBtn">Start Recording</button>
            <button id="stopBtn" class="stop" disabled>Stop Recording</button>
            <button id="saveBtn" class="save">Save Data</button>
            <button id="downloadBtn">Download CSV</button>
            <input type="file" id="fileInput" accept=".csv" class="hidden">
        </div>

        <div class="github-controls">
        <h3>GitHub Integration</h3>
        <div class="github-status">
            <span id="githubStatus">Not connected to GitHub</span>
            <button id="configureGithubBtn">Configure GitHub</button>
        </div>
        <div class="github-actions">
            <button id="loadFromGithubBtn">Load from GitHub</button>
            <button id="createBackupBtn">Create GitHub Backup</button>
        </div>
        </div>
            
        <div class="status" id="status">Ready to record</div>
        
        <div class="transcript-container">
            <h3>Speech Transcript:</h3>
            <div class="transcript" id="transcript"></div>
        </div>
        
       <div class="form-entry">
        <h3>Manual Entry Form</h3>
        <div class="form-row">
            <div class="form-group">
                <label for="datePicker">Date:</label>
                <input type="date" id="datePicker">
            </div>
            <div class="form-group">
                <label for="wakeTime">Wake Up Time:</label>
                <input type="time" id="wakeTime">
            </div>
            <div class="form-group">
                <label for="milesRun">Miles Run:</label>
                <input type="number" id="milesRun" step="0.1" min="0">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="pressUps">Press Ups:</label>
                <input type="number" id="pressUps" min="0">
            </div>
            <div class="form-group">
                <label for="sitUps">Sit Ups:</label>
                <input type="number" id="sitUps" min="0">
            </div>
            <div class="form-group">
                <label for="backs">Backs:</label>
                <input type="number" id="backs" min="0">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="headUps">Head Ups:</label>
                <input type="number" id="headUps" min="0">
            </div>
            <div class="form-group">
                <label for="guitarHours">Guitar Hours:</label>
                <input type="number" id="guitarHours" step="0.25" min="0">
            </div>
            <div class="form-group">
                <label for="drinks">Drinks:</label>
                <input type="number" id="drinks" min="0">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="flossed">Flossed:</label>
                <select id="flossed">
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                </select>
            </div>
            <div class="form-group">
                <label for="finasteride">Finasteride:</label>
                <select id="finasteride">
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                </select>
            </div>
            <div class="form-group">
                <label for="moodScore">Mood Score:</label>
                <input type="number" id="moodScore" min="1" max="10" step="1">
            </div>
            <div class="form-group">
                <button id="addEntryBtn" class="save">Add Entry</button>
            </div>
        </div>
    </div>

        <div class="data-display">
            <h3>Your Fitness Data:</h3>
            <div style="overflow-x: auto;">
                <table id="dataTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Wake Up Time</th>
                            <th>Miles Run</th>
                            <th>Press Ups</th>
                            <th>Sit Ups</th>
                            <th>Backs</th>
                            <th>Head Ups</th>
                            <th>Guitar Played / Hrs</th>
                            <th>Drinks</th>
                            <th>Flossed</th>
                            <th>Finasteride</th>
                            <th>Mood Score</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Analytics Section -->
        <div class="analytics-section">
            <h3>Analytics</h3>
            <div class="chart-container">
                <canvas id="milesChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="exerciseChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="moodChart"></canvas>
            </div>
        </div>
        
        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="loading">
            Loading data...
        </div>
    </div>

    <script>
    // Global variables and utility functions
    let fitnessData = [];
    let charts = {
        miles: null,
        exercise: null,
        mood: null
    };
    let recognition = null;
    let isRecording = false;

    // Initialize speech recognition
    if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
        recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.continuous = true;
        recognition.interimResults = true;
        recognition.lang = 'en-US';
    }

    // Wait for DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', () => {
        // DOM Elements
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const saveBtn = document.getElementById('saveBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const fileInput = document.getElementById('fileInput');
        const addEntryBtn = document.getElementById('addEntryBtn');
        const status = document.getElementById('status');
        const transcript = document.getElementById('transcript');
        const tableBody = document.getElementById('tableBody');

        // Set up speech recognition handlers
        if (recognition) {
            recognition.onstart = () => {
                status.innerHTML = '<span class="record-indicator"></span> Recording...';
                isRecording = true;
                startBtn.disabled = true;
                stopBtn.disabled = false;
            };

            recognition.onend = () => {
                status.textContent = 'Recording stopped';
                isRecording = false;
                startBtn.disabled = false;
                stopBtn.disabled = true;
                handleTranscriptAfterRecording();
            };

            recognition.onresult = (event) => {
                let interimTranscript = '';
                let finalTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const result = event.results[i];
                    if (result.isFinal) {
                        finalTranscript += result[0].transcript;
                    } else {
                        interimTranscript += result[0].transcript;
                    }
                }
                
                transcript.innerHTML = finalTranscript + '<i style="color: #888;">' + interimTranscript + '</i>';
            };

            recognition.onerror = (event) => {
                status.textContent = 'Error: ' + event.error;
                startBtn.disabled = false;
                stopBtn.disabled = true;
            };
        } else {
            status.textContent = 'Speech recognition not supported in this browser.';
            startBtn.disabled = true;
        }

        // Event Listeners
        startBtn.addEventListener('click', () => {
            if (recognition) {
                transcript.textContent = '';
                recognition.start();
            }
        });

        stopBtn.addEventListener('click', () => {
            if (recognition && isRecording) {
                recognition.stop();
            }
        });

        downloadBtn.addEventListener('click', () => {
            const csv = convertToCSV();
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.setAttribute('href', url);
            a.setAttribute('download', 'tracker.csv');
            a.click();
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    fitnessData = parseCSV(event.target.result);
                    renderTable();
                    status.textContent = 'CSV file imported successfully';
                };
                reader.readAsText(file);
            }
        });

        // Add Entry Button Event Listener
        addEntryBtn.addEventListener('click', () => {
            const editIndex = addEntryBtn.getAttribute('data-edit-index');
            const dateInput = document.getElementById('datePicker').value;
            
            if (!dateInput) {
                alert('Please select a date');
                return;
            }
            
            const isoDate = formatDateToISO(dateInput);
            
            const newEntry = {
                date: isoDate,
                wakeUpTime: document.getElementById('wakeTime').value,
                milesRun: parseFloat(document.getElementById('milesRun').value) || 0,
                pressUps: parseInt(document.getElementById('pressUps').value) || 0,
                sitUps: parseInt(document.getElementById('sitUps').value) || 0,
                backs: parseInt(document.getElementById('backs').value) || 0,
                headUps: parseInt(document.getElementById('headUps').value) || 0,
                guitarHours: parseFloat(document.getElementById('guitarHours').value) || 0,
                drinks: parseInt(document.getElementById('drinks').value) || 0,
                flossed: document.getElementById('flossed').value,
                finasteride: document.getElementById('finasteride').value,
                moodScore: document.getElementById('moodScore').value || ''
            };
            
            const existingIndex = editIndex !== null ? 
                parseInt(editIndex) : 
                fitnessData.findIndex(entry => entry.date === isoDate);
            
            if (existingIndex >= 0) {
                fitnessData[existingIndex] = newEntry;
            } else {
                fitnessData.push(newEntry);
            }
            
            // Reset form and button
            addEntryBtn.textContent = 'Add Entry';
            addEntryBtn.removeAttribute('data-edit-index');
            
            // Clear form fields
            document.getElementById('datePicker').value = '';
            document.getElementById('wakeTime').value = '';
            document.getElementById('milesRun').value = '';
            document.getElementById('pressUps').value = '';
            document.getElementById('sitUps').value = '';
            document.getElementById('backs').value = '';
            document.getElementById('headUps').value = '';
            document.getElementById('guitarHours').value = '';
            document.getElementById('drinks').value = '';
            document.getElementById('flossed').value = 'Yes';
            document.getElementById('finasteride').value = 'Yes';
            document.getElementById('moodScore').value = '';
            
            // Update table and charts
            renderTable();
        });

        // GitHub related event listeners
        document.getElementById('configureGithubBtn').addEventListener('click', () => {
            createGitHubAuthModal();
        });

        document.getElementById('loadFromGithubBtn').addEventListener('click', async () => {
            status.textContent = 'Loading data from GitHub...';
            
            try {
                const success = await loadFitnessDataFromGitHub();
                if (success) {
                    status.textContent = 'Data loaded from GitHub successfully';
                }
            } catch (error) {
                status.textContent = `Error loading from GitHub: ${error.message}`;
            }
        });

        document.getElementById('createBackupBtn').addEventListener('click', async () => {
            status.textContent = 'Creating backup on GitHub...';
            
            try {
                const success = await saveFitnessDataToGitHub();
                if (success) {
                    status.textContent = 'Backup created on GitHub successfully';
                }
            } catch (error) {
                status.textContent = `Error creating backup: ${error.message}`;
            }
        });

        saveBtn.addEventListener('click', async () => {
            status.textContent = 'Saving data to GitHub...';
            
            if (!githubConfig.isAuthenticated) {
                status.textContent = 'GitHub authentication required';
                createGitHubAuthModal();
                return;
            }
            
            try {
                const success = await saveFitnessDataToGitHub();
                if (success) {
                    status.textContent = 'Data saved to GitHub successfully';
                }
            } catch (error) {
                status.textContent = `Error saving to GitHub: ${error.message}`;
            }
        });

        // Initialize the app
        checkGitHubAuth();
        initializeApp();
        
        // Set today's date in the date picker by default
        const today = new Date();
        document.getElementById('datePicker').value = formatDateToISO(today);
        
        // Initial render
        renderTable();
    });

    // ... rest of your existing functions ...
    </script>
</body>
</html>
